---
phase: 06-v1-gap-closure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/REQUIREMENTS.md
  - .planning/phases/01-project-initialization/01-VERIFICATION.md
  - .planning/phases/02-prompt-generation/02-VERIFICATION.md
  - .planning/phases/01-project-initialization/01-02-SUMMARY.md
  - .planning/phases/02-prompt-generation/02-01-SUMMARY.md
  - .planning/phases/02-prompt-generation/02-02-SUMMARY.md
  - .planning/phases/03-phase-execution/03-02-SUMMARY.md
  - .gitignore
  - scripts/ralph-execute.sh
  - lib/discovery.sh
  - tests/discovery.bats
  - lib/commands/cleanup.sh
autonomous: true
requirements:
  - EXEC-06
gap_closure: true

must_haves:
  truths:
    - "Phase 1 has a VERIFICATION.md confirming INIT-01, INIT-02, INIT-03, XCUT-01 are satisfied"
    - "Phase 2 has a VERIFICATION.md confirming EXEC-02, EXEC-03, EXEC-04, EXEC-07 are satisfied"
    - "All 20 v1 requirement checkboxes in REQUIREMENTS.md are checked"
    - "REQUIREMENTS.md traceability table shows Complete status for all v1 requirements"
    - ".gitignore includes .ralph/worktree-registry.json"
    - "scripts/ralph-execute.sh step 7 references 'gsd-ralph cleanup' instead of 'ralph-cleanup.sh'"
    - "worktree_path_for_plan function is removed from lib/discovery.sh and its test from tests/discovery.bats"
    - "EXEC-01 requirement text updated to match branch-based implementation"
    - "ShellCheck SC2034 fix applied to lib/commands/cleanup.sh"
    - "SUMMARY frontmatter added to 01-02, 02-01, 02-02 and 03-02 requirements-completed updated"
  artifacts:
    - path: ".planning/phases/01-project-initialization/01-VERIFICATION.md"
      provides: "Retroactive verification report for Phase 1"
      contains: "INIT-01"
    - path: ".planning/phases/02-prompt-generation/02-VERIFICATION.md"
      provides: "Retroactive verification report for Phase 2"
      contains: "EXEC-02"
    - path: ".planning/REQUIREMENTS.md"
      provides: "All v1 checkboxes checked, traceability table updated"
      contains: "\\[x\\].*INIT-01"
  key_links:
    - from: ".planning/REQUIREMENTS.md"
      to: "01-VERIFICATION.md, 02-VERIFICATION.md"
      via: "Requirement IDs cross-referenced between checkboxes and verification reports"
      pattern: "INIT-01|EXEC-02"
---

<objective>
Close all documentation, metadata, and tech debt gaps identified in the v1 milestone audit. This includes retroactive VERIFICATION.md files for Phases 1 and 2, REQUIREMENTS.md checkbox updates, SUMMARY frontmatter corrections, .gitignore update, orphaned code removal, and script reference fixes.

Purpose: Bring the project to a clean v1 state where all requirements are formally verified, all metadata is machine-readable, and all tech debt from the audit is resolved. No runtime code changes (terminal bell is in plan 06-01).

Output: Two VERIFICATION.md files, updated REQUIREMENTS.md, corrected SUMMARY frontmatter, updated .gitignore, cleaned discovery.sh, fixed ralph-execute.sh, ShellCheck-clean cleanup.sh.
</objective>

<execution_context>
@/Users/daniswhoiam/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daniswhoiam/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/v1-MILESTONE-AUDIT.md
@.planning/phases/03-phase-execution/03-VERIFICATION.md
@.planning/phases/05-cleanup/05-VERIFICATION.md
@.planning/phases/01-project-initialization/01-02-SUMMARY.md
@.planning/phases/02-prompt-generation/02-01-SUMMARY.md
@.planning/phases/02-prompt-generation/02-02-SUMMARY.md
@.planning/phases/03-phase-execution/03-02-SUMMARY.md
@.planning/phases/06-v1-gap-closure/06-RESEARCH.md
@lib/discovery.sh
@tests/discovery.bats
@lib/commands/cleanup.sh
@scripts/ralph-execute.sh
@.gitignore
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create retroactive VERIFICATION.md files for Phases 1 and 2</name>
  <files>.planning/phases/01-project-initialization/01-VERIFICATION.md, .planning/phases/02-prompt-generation/02-VERIFICATION.md</files>
  <action>
Create retroactive VERIFICATION.md files following the exact format of `03-VERIFICATION.md` and `05-VERIFICATION.md`. These are retroactive (phases predated the GSD verification workflow), so set `re_verification: true` in frontmatter.

**Phase 1 VERIFICATION.md (`01-VERIFICATION.md`):**

YAML frontmatter:
```yaml
---
phase: 01-project-initialization
verified: {current ISO timestamp}
status: passed
score: 4/4 requirements verified
re_verification: true
---
```

Content structure (following 05-VERIFICATION.md format):
- **Observable Truths**: One row per ROADMAP success criterion for Phase 1 (there are 4). Evidence should cite specific functions, test counts, and line numbers from the existing implementation. All 4 are verifiable from existing test results and code inspection:
  1. `gsd-ralph init` creates `.ralph/` with defaults -- `cmd_init()` in `lib/commands/init.sh`, 21 init tests pass
  2. Clear error messages for missing dependencies -- `check_all_dependencies()` in `lib/common.sh`, prints name + install hint
  3. Auto-detect project type -- `detect_project_type()` in `lib/config.sh`, covers 13 ecosystems, 8 config tests pass
  4. Works with any project stack -- `detect_project_type` has "unknown" fallback for unrecognized projects
- **Required Artifacts**: List `lib/commands/init.sh`, `lib/config.sh`, `lib/common.sh`, `tests/init.bats`, `tests/config.bats`, `tests/common.bats`, `bin/gsd-ralph`
- **Key Link Verification**: `bin/gsd-ralph` -> `lib/commands/init.sh` -> `lib/config.sh` -> `lib/common.sh`
- **Requirements Coverage**: INIT-01, INIT-02, INIT-03, XCUT-01 -- all SATISFIED with evidence from tests and code
- **Human Verification Required**: None (all behaviors tested by 38 Phase 1 tests)

Run `make test` and cite the actual test count in the evidence.

**Phase 2 VERIFICATION.md (`02-VERIFICATION.md`):**

YAML frontmatter:
```yaml
---
phase: 02-prompt-generation
verified: {current ISO timestamp}
status: passed
score: 4/4 requirements verified
re_verification: true
---
```

Content structure:
- **Observable Truths**: One row per ROADMAP success criterion for Phase 2 (there are 4):
  1. Generates context-specific PROMPT.md -- `generate_prompt_md()` in `lib/prompt.sh`, 12 prompt tests pass
  2. Extracts tasks into fix_plan.md -- `extract_tasks_to_fix_plan()` uses python3 regex, tested
  3. Generates .ralphrc per worktree -- init creates .ralphrc from template, generate creates per-plan .ralphrc
  4. Handles dual naming conventions -- `discover_plan_files()` handles both PLAN.md and NN-MM-PLAN.md, 12 discovery tests pass
- **Required Artifacts**: List `lib/discovery.sh`, `lib/prompt.sh`, `lib/templates.sh`, `lib/commands/generate.sh`, `templates/PROMPT.md.template`, `templates/AGENT.md.template`, `tests/discovery.bats`, `tests/prompt.bats`, `tests/generate.bats`
- **Key Link Verification**: `bin/gsd-ralph` -> `lib/commands/generate.sh` -> `lib/prompt.sh` -> `lib/templates.sh`
- **Requirements Coverage**: EXEC-02, EXEC-03, EXEC-04, EXEC-07 -- all SATISFIED
- **Human Verification Required**: None (all behaviors tested by 41 Phase 2 tests)

Both files should end with `_Verified: {timestamp}_` and `_Verifier: Claude (gsd-verifier, retroactive)_`.
  </action>
  <verify>
1. Both files exist and have valid YAML frontmatter:
```bash
head -10 .planning/phases/01-project-initialization/01-VERIFICATION.md
head -10 .planning/phases/02-prompt-generation/02-VERIFICATION.md
```
2. Requirement IDs are present:
```bash
grep -c 'INIT-0[123]\|XCUT-01' .planning/phases/01-project-initialization/01-VERIFICATION.md
grep -c 'EXEC-0[2347]' .planning/phases/02-prompt-generation/02-VERIFICATION.md
```
3. Both have `re_verification: true` and `status: passed`.
  </verify>
  <done>
Phase 1 has `01-VERIFICATION.md` confirming INIT-01, INIT-02, INIT-03, XCUT-01 satisfied with evidence from 38 tests and code inspection. Phase 2 has `02-VERIFICATION.md` confirming EXEC-02, EXEC-03, EXEC-04, EXEC-07 satisfied with evidence from 41 tests. Both follow the established verification format with `re_verification: true`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update REQUIREMENTS.md, SUMMARY frontmatter, and resolve tech debt</name>
  <files>.planning/REQUIREMENTS.md, .planning/phases/01-project-initialization/01-02-SUMMARY.md, .planning/phases/02-prompt-generation/02-01-SUMMARY.md, .planning/phases/02-prompt-generation/02-02-SUMMARY.md, .planning/phases/03-phase-execution/03-02-SUMMARY.md, .gitignore, scripts/ralph-execute.sh, lib/discovery.sh, tests/discovery.bats, lib/commands/cleanup.sh</files>
  <action>
**1. Update REQUIREMENTS.md checkboxes and traceability:**

Check all v1 requirement checkboxes that are currently unchecked (11 total). Change `- [ ]` to `- [x]` for:
- INIT-01, INIT-02, INIT-03 (Phase 1 -- implementation complete, now verified)
- EXEC-01, EXEC-02, EXEC-03, EXEC-04, EXEC-05, EXEC-06, EXEC-07 (Phase 2/3 -- complete; EXEC-06 will be complete after plan 06-01 runs)
- XCUT-01 (Phase 1 -- implementation complete, now verified)

**Note on EXEC-06:** Check this box because this plan (06-02) runs in wave 1 alongside 06-01. By the time verification happens, 06-01 will have implemented the terminal bell. If concerned about ordering, the executor can defer the EXEC-06 checkbox to after 06-01 is confirmed.

Update EXEC-01 requirement text from:
```
- [ ] **EXEC-01**: User can create one git worktree per plan for a given phase with `gsd-ralph execute N`
```
to:
```
- [x] **EXEC-01**: User can create an execution environment (branch-based) for a given phase with `gsd-ralph execute N`
```

Update the traceability table: change "Pending" to "Complete" for all v1 requirements:
- INIT-01, INIT-02, INIT-03: Pending -> Complete
- EXEC-01 through EXEC-07: Pending -> Complete
- XCUT-01: Pending -> Complete

Update the EXEC-06 Phase column from "Phase 6" to "Phase 6" (already correct) and status to "Complete".

**2. Add SUMMARY frontmatter to Phase 1 and 2 SUMMARYs:**

**`01-02-SUMMARY.md`**: Add YAML frontmatter block at the very top (before the existing `# Plan 01-02 Summary` heading):
```yaml
---
phase: 01-project-initialization
plan: 02
subsystem: initialization
tags: [bash, cli, init-command, dependency-check, project-detection]
requires:
  - phase: 01-project-initialization
    provides: CLI skeleton, shared libraries (common.sh, config.sh), bats test infrastructure
provides:
  - gsd-ralph init command with dependency checking and project type detection
  - 21 integration tests for init command
affects: [02-prompt-generation]
tech-stack:
  added: []
  patterns: [init-command-pattern, dependency-checking, project-type-detection]
key-files:
  created:
    - lib/commands/init.sh
    - tests/init.bats
  modified:
    - bin/gsd-ralph
key-decisions:
  - "Ralph is a soft dependency (warning only), not a hard requirement for init"
  - "Idempotent init: warns if .ralph/ exists, succeeds with --force"
patterns-established:
  - "Command pattern: usage function + cmd_X function + argument parsing"
  - "Dependency checking: check_dependency per tool, check_all_dependencies for suite"
requirements-completed:
  - INIT-01
  - INIT-02
  - INIT-03
  - XCUT-01
duration: single-session
completed: 2026-02-13
---
```

**`02-01-SUMMARY.md`**: Add YAML frontmatter block at the very top:
```yaml
---
phase: 02-prompt-generation
plan: 01
subsystem: discovery
tags: [bash, discovery, templates, test-fixtures]
requires: []
provides:
  - Plan file discovery module (find_phase_dir, discover_plan_files, plan_id_from_filename)
  - Parameterized PROMPT.md and AGENT.md templates
  - Test fixture infrastructure for plan files
  - 12 discovery unit tests
affects: [02-prompt-generation, 03-phase-execution]
tech-stack:
  added: []
  patterns: [glob-based-discovery, parameterized-templates, PLAN_FILES-global-array]
key-files:
  created:
    - lib/discovery.sh
    - templates/PROMPT.md.template
    - templates/AGENT.md.template
    - tests/discovery.bats
    - tests/test_helper/fixtures/
  modified: []
key-decisions:
  - "Glob pattern [0-9][0-9]-[0-9][0-9]-PLAN.md for precise plan matching"
  - "Global variables (PHASE_DIR, PLAN_FILES, PLAN_COUNT) for discovery results"
patterns-established:
  - "Discovery module: find_phase_dir sets PHASE_DIR, discover_plan_files sets PLAN_FILES array"
  - "Parameterized templates with {{VARIABLE}} placeholders rendered by templates.sh"
requirements-completed:
  - EXEC-07
duration: single-session
completed: 2026-02-18
---
```

**`02-02-SUMMARY.md`**: Add YAML frontmatter block at the very top:
```yaml
---
phase: 02-prompt-generation
plan: 02
subsystem: prompt-generation
tags: [bash, cli, generate-command, prompt-generation, task-extraction]
requires:
  - phase: 02-prompt-generation
    provides: discovery module, parameterized templates, test fixtures
provides:
  - File generation pipeline (extract_tasks_to_fix_plan, generate_prompt_md, etc.)
  - gsd-ralph generate N subcommand
  - 12 prompt unit tests and 17 generate integration tests
affects: [03-phase-execution]
tech-stack:
  added: []
  patterns: [python3-regex-task-extraction, two-part-template-generation]
key-files:
  created:
    - lib/prompt.sh
    - lib/commands/generate.sh
    - tests/prompt.bats
    - tests/generate.bats
  modified:
    - bin/gsd-ralph
key-decisions:
  - "python3 -c with re.findall for multiline XML task extraction"
  - "Two-part generation: render_template for base + heredoc for dynamic sections"
patterns-established:
  - "Task extraction via python3 regex (not grep/sed)"
  - "Generate command: discovery -> generation -> per-plan output directory"
requirements-completed:
  - EXEC-02
  - EXEC-03
  - EXEC-04
duration: single-session
completed: 2026-02-18
---
```

**`03-02-SUMMARY.md`**: Update the existing `requirements-completed: []` to:
```yaml
requirements-completed:
  - EXEC-01
  - EXEC-05
```

**3. Tech debt fixes:**

**`.gitignore`**: Add the following line at the end of the "Ralph runtime artifacts" section (after the existing `.ralph/` entries, before the `# OS` section):
```
.ralph/worktree-registry.json
```

**`scripts/ralph-execute.sh`**: On line 300, change:
```
echo -e "       ${GREEN}./scripts/ralph-cleanup.sh ${PHASE_NUM}${NC}"
```
to:
```
echo -e "       ${GREEN}gsd-ralph cleanup ${PHASE_NUM}${NC}"
```

**`lib/discovery.sh`**: Remove the `worktree_path_for_plan` function (lines 70-79, including the blank line and comment before it):
```bash
# Compute worktree path for a plan.
# Format: ${parent_dir}/${repo_name}-p${phase_num}-${plan_id}
# Args: parent_dir, repo_name, phase_num, plan_id
worktree_path_for_plan() {
    local parent_dir="$1"
    local repo_name="$2"
    local phase_num="$3"
    local plan_id="$4"
    echo "${parent_dir}/${repo_name}-p${phase_num}-${plan_id}"
}
```

**`tests/discovery.bats`**: Remove the corresponding test (lines 132-138):
```bash
# --- worktree_path_for_plan ---

@test "worktree_path_for_plan computes correct path" {
    run worktree_path_for_plan "/home/user/projects" "myrepo" "2" "01"
    assert_success
    assert_output "/home/user/projects/myrepo-p2-01"
}
```

**`lib/commands/cleanup.sh`**: Add `# shellcheck disable=SC2034` before the `while` loop at line 42 (matching the pattern used in execute.sh line 44, generate.sh line 38, merge.sh line 120):
```bash
    # shellcheck disable=SC2034
    while [[ $# -gt 0 ]]; do
```
  </action>
  <verify>
1. REQUIREMENTS.md checkboxes:
```bash
grep -c '\[x\]' .planning/REQUIREMENTS.md
```
Should show 20 (all v1 requirements checked).

2. Traceability table has no "Pending" entries for v1:
```bash
grep 'Pending' .planning/REQUIREMENTS.md
```
Should return nothing (or only non-v1 content).

3. .gitignore includes registry:
```bash
grep 'worktree-registry' .gitignore
```

4. ralph-execute.sh references gsd-ralph:
```bash
grep 'gsd-ralph cleanup' scripts/ralph-execute.sh
```

5. Orphaned function removed:
```bash
grep 'worktree_path_for_plan' lib/discovery.sh tests/discovery.bats
```
Should return nothing.

6. ShellCheck passes:
```bash
make lint
```

7. All tests pass (with the orphaned test removed):
```bash
make test
```

8. SUMMARY frontmatter present:
```bash
head -5 .planning/phases/01-project-initialization/01-02-SUMMARY.md
head -5 .planning/phases/02-prompt-generation/02-01-SUMMARY.md
head -5 .planning/phases/02-prompt-generation/02-02-SUMMARY.md
grep 'requirements-completed' .planning/phases/03-phase-execution/03-02-SUMMARY.md
```
  </verify>
  <done>
All 20 v1 requirement checkboxes checked in REQUIREMENTS.md. Traceability table shows Complete for all v1 requirements. EXEC-01 text updated to match branch-based implementation. SUMMARY frontmatter added to 01-02, 02-01, 02-02 and 03-02 requirements-completed updated with EXEC-01, EXEC-05. .gitignore includes worktree-registry.json. ralph-execute.sh references gsd-ralph cleanup. worktree_path_for_plan removed from discovery.sh and its test from discovery.bats. ShellCheck SC2034 fix applied to cleanup.sh. `make check` passes clean.
  </done>
</task>

</tasks>

<verification>
1. `head -10 .planning/phases/01-project-initialization/01-VERIFICATION.md` shows valid YAML frontmatter with `status: passed`
2. `head -10 .planning/phases/02-prompt-generation/02-VERIFICATION.md` shows valid YAML frontmatter with `status: passed`
3. `grep -c '\[x\]' .planning/REQUIREMENTS.md` returns 20
4. `grep 'Pending' .planning/REQUIREMENTS.md` returns no v1 requirements with Pending status
5. `grep 'worktree-registry' .gitignore` shows the line exists
6. `grep 'gsd-ralph cleanup' scripts/ralph-execute.sh` shows the updated reference
7. `grep 'worktree_path_for_plan' lib/discovery.sh tests/discovery.bats` returns nothing
8. `make lint` passes (ShellCheck clean including cleanup.sh SC2034 fix)
9. `make test` passes (all tests, one less discovery test after orphan removal)
10. Phase 1/2 SUMMARY files have YAML frontmatter blocks
</verification>

<success_criteria>
- Phase 1 VERIFICATION.md exists confirming INIT-01, INIT-02, INIT-03, XCUT-01 satisfied
- Phase 2 VERIFICATION.md exists confirming EXEC-02, EXEC-03, EXEC-04, EXEC-07 satisfied
- All 20 v1 requirement checkboxes checked in REQUIREMENTS.md
- Traceability table fully updated (all Complete)
- SUMMARY frontmatter present on 01-02, 02-01, 02-02; 03-02 requirements-completed updated
- .gitignore includes worktree-registry.json
- scripts/ralph-execute.sh step 7 says "gsd-ralph cleanup"
- worktree_path_for_plan removed from discovery.sh and its test
- ShellCheck SC2034 fix in cleanup.sh
- make check passes clean (lint + tests)
</success_criteria>

<output>
After completion, create `.planning/phases/06-v1-gap-closure/06-02-SUMMARY.md`
</output>
